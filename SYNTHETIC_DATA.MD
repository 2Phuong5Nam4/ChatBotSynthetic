ğŸ”„ Flow ÄÃºng vÃ  Output cá»§a tá»«ng Agent

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  INPUT: raw_conversations.json + procedure     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
        â”Œâ”€ Agent 1: Teacher LLM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  INPUT: Raw conversation + Procedureâ”‚
        â”‚  PROCESS:                           â”‚
        â”‚   - Analyze each turn               â”‚
        â”‚   - Check procedure compliance      â”‚
        â”‚   - Generate thinking traces        â”‚
        â”‚   - Propose corrections if needed   â”‚
        â”‚  OUTPUT:                            â”‚
        â”‚   - Enhanced conversation with      â”‚
        â”‚     thinking field in each turn     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
        â”Œâ”€ Agent 2: Validator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  INPUT: Enhanced conversation       â”‚
        â”‚         from Agent 1                â”‚
        â”‚  PROCESS:                           â”‚
        â”‚   - Step-level scoring              â”‚
        â”‚   - Verify thinking quality         â”‚
        â”‚   - Check procedure compliance      â”‚
        â”‚   - Flag violations/errors          â”‚
        â”‚  OUTPUT:                            â”‚
        â”‚   - Quality score (0-1)             â”‚
        â”‚   - Validation report               â”‚
        â”‚   - Accept/Reject decision          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
           â”Œâ”€â”€â”€ IF score >= threshold â”€â”€â”€â”
           â”‚                              â”‚
      ACCEPT â”‚                       REJECT â”‚
           â†“                              â†“
    â”Œâ”€ Agent 3: User Simulator â”€â”   â”Œâ”€ Feedback Loop â”€â”
    â”‚  INPUT: Accepted conv      â”‚   â”‚  Return to       â”‚
    â”‚  PROCESS:                  â”‚   â”‚  Agent 1 with    â”‚
    â”‚   - Generate variants      â”‚   â”‚  validator       â”‚
    â”‚   - Create edge cases      â”‚   â”‚  feedback        â”‚
    â”‚   - Paraphrase user msgs   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  OUTPUT:                   â”‚
    â”‚   - 3-5 synthetic variants â”‚
    â”‚     per original conv      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  FINAL TRAINING DATA   â”‚
      â”‚  with thinking traces  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ---
  ğŸ“ VÃ­ dá»¥ Cá»¥ Thá»ƒ vá»›i Data Thá»±c

  INPUT (tá»« raw_conversations.json):

  {
    "Intentions": "C1.1.3 - Äá»•i máº­t kháº©u",
    "messages": [
      {
        "role": "user",
        "content": "Em bá»‹ máº¥t máº­t kháº©u HVN Ä‘áº·t hÃ ng, há»— trá»£ em láº¥y láº¡i Ä‘Æ°á»£c khÃ´ng?"
      },
      {
        "role": "assistant",
        "content": "Chá»‹ nháº¥n QuÃªn Máº­t Kháº©u, nháº­p tÃªn Ä‘Äƒng nháº­p 10409303, nháº­n mÃ£ OTP vÃ  táº¡o máº­t kháº©u má»›i 12 kÃ½ tá»±."
      }
    ]
  }

  ---
  OUTPUT cá»§a Agent 1 (Teacher LLM):

  {
    "Intentions": "C1.1.3 - Äá»•i máº­t kháº©u",
    "messages": [
      {
        "role": "user",
        "content": "Em bá»‹ máº¥t máº­t kháº©u HVN Ä‘áº·t hÃ ng, há»— trá»£ em láº¥y láº¡i Ä‘Æ°á»£c khÃ´ng?"
      },
      {
        "role": "assistant",
        "content": "Dáº¡, chá»‹ vui lÃ²ng cho em xÃ¡c nháº­n má»™t sá»‘ thÃ´ng tin:\n- Chá»‹ lÃ  chá»§ Ä‘iá»ƒm bÃ¡n, NPP hay nhÃ¢n viÃªn Heineken áº¡?\n- MÃ£ cá»­a hÃ ng hoáº·c sá»‘ Ä‘iá»‡n thoáº¡i Ä‘Äƒng kÃ½ HVN cá»§a chá»‹ lÃ  gÃ¬ áº¡?",
        "thinking": {
          "procedure_step": "BÆ°á»›c 1: Nháº­n diá»‡n nhu cáº§u vÃ  xÃ¡c thá»±c sÆ¡ bá»™",
          "reasoning": "KhÃ¡ch hÃ ng bÃ¡o máº¥t máº­t kháº©u, thuá»™c case 'QuÃªn máº­t kháº©u'. Theo procedure, trÆ°á»›c khi hÆ°á»›ng dáº«n cáº§n:\n1. XÃ¡c Ä‘á»‹nh Ä‘á»‘i tÆ°á»£ng (Ä‘iá»ƒm bÃ¡n/NPP/nhÃ¢n viÃªn)\n2. Thu tháº­p thÃ´ng tin Ä‘á»‹nh danh (mÃ£ cá»­a hÃ ng/NPP hoáº·c SÄT Ä‘Äƒng kÃ½)\n\nAssistant message trong raw conversation Ä‘Ã£ nháº£y tháº³ng vÃ o hÆ°á»›ng dáº«n vá»›i mÃ£ 10409303 mÃ  khÃ´ng xÃ¡c thá»±c thÃ´ng tin KH trÆ°á»›c. Äiá»u nÃ y vi pháº¡m BÆ°á»›c 1 cá»§a procedure.",
          "correction_applied": true,
          "original_response": "Chá»‹ nháº¥n QuÃªn Máº­t Kháº©u, nháº­p tÃªn Ä‘Äƒng nháº­p 10409303, nháº­n mÃ£ OTP vÃ  táº¡o máº­t kháº©u má»›i 12 kÃ½ tá»±.",
          "compliance_check": {
            "follows_procedure": false,
            "missing_steps": ["XÃ¡c Ä‘á»‹nh Ä‘á»‘i tÆ°á»£ng KH", "Thu tháº­p thÃ´ng tin Ä‘á»‹nh danh"],
            "security_concern": "Cung cáº¥p mÃ£ cá»­a hÃ ng cá»¥ thá»ƒ (10409303) mÃ  khÃ´ng xÃ¡c thá»±c danh tÃ­nh KH"
          }
        }
      },
      {
        "role": "user",
        "content": "Em lÃ  chá»§ Ä‘iá»ƒm bÃ¡n, mÃ£ cá»­a hÃ ng 10409303 áº¡."
      },
      {
        "role": "assistant",
        "content": "Dáº¡, em hÆ°á»›ng dáº«n chá»‹ Ä‘áº·t láº¡i máº­t kháº©u nhÆ° sau:\n\nBÆ°á»›c 1: TrÃªn app HVN, chá»‹ chá»n 'QuÃªn máº­t kháº©u'\nBÆ°á»›c 2: Nháº­p TÃªn Ä‘Äƒng nháº­p lÃ  mÃ£ cá»­a hÃ ng: 10409303\nBÆ°á»›c 3: Nháº­p mÃ£ OTP Ä‘Æ°á»£c gá»­i vá» sá»‘ Ä‘iá»‡n thoáº¡i Ä‘Äƒng kÃ½ HVN cá»§a chá»‹\nBÆ°á»›c 4: Táº¡o máº­t kháº©u má»›i bao gá»“m 12 kÃ½ tá»±, lÆ°u Ã½ khÃ´ng sá»­ dá»¥ng láº¡i máº­t kháº©u Ä‘Ã£ dÃ¹ng trÆ°á»›c Ä‘Ã¢y áº¡\nBÆ°á»›c 5: Sau Ä‘Ã³ chá»‹ Ä‘Äƒng nháº­p láº¡i báº±ng mÃ£ cá»­a hÃ ng vÃ  máº­t kháº©u má»›i nhÃ©",
        "thinking": {
          "procedure_step": "BÆ°á»›c 3: HÆ°á»›ng dáº«n Ä‘áº·t láº¡i máº­t kháº©u qua 'QuÃªn máº­t kháº©u'",
          "reasoning": "Sau khi Ä‘Ã£ xÃ¡c thá»±c thÃ´ng tin KH (mÃ£ cá»­a hÃ ng 10409303), bÃ¢y giá» hÆ°á»›ng dáº«n chi tiáº¿t cÃ¡c bÆ°á»›c theo BÆ°á»›c 3 cá»§a procedure:\n1. Chá»n QuÃªn máº­t kháº©u trÃªn app\n2. Nháº­p tÃªn Ä‘Äƒng nháº­p (= mÃ£ cá»­a hÃ ng)\n3. Nháº­p OTP\n4. Táº¡o máº­t kháº©u má»›i 12 kÃ½ tá»±, khÃ´ng trÃ¹ng máº­t kháº©u cÅ©\n5. ÄÄƒng nháº­p láº¡i\n\nCáº§n nháº¥n máº¡nh quy táº¯c 12 kÃ½ tá»± vÃ  khÃ´ng dÃ¹ng láº¡i máº­t kháº©u cÅ© Ä‘á»ƒ trÃ¡nh lá»—i 'máº­t kháº©u Ä‘Ã£ sá»­ dá»¥ng trÆ°á»›c Ä‘Ã³'.",
          "correction_applied": false,
          "compliance_check": {
            "follows_procedure": true,
            "covers_all_steps": true,
            "includes_password_rules": true
          }
        }
      }
    ],
    "metadata": {
      "teacher_model": "claude-3-5-sonnet",
      "corrections_made": 1,
      "procedure_compliance": "improved"
    }
  }

  ---
  OUTPUT cá»§a Agent 2 (Validator):

  {
    "conversation_id": "conv_001",
    "validation_result": {
      "overall_score": 0.92,
      "accept": true,
      "detailed_scores": {
        "procedure_compliance": 0.95,
        "thinking_quality": 0.90,
        "information_security": 0.88,
        "conversation_flow": 0.95
      },
      "turn_level_analysis": [
        {
          "turn": 1,
          "assistant_message": "Dáº¡, chá»‹ vui lÃ²ng cho em xÃ¡c nháº­n...",
          "scores": {
            "procedure_step_correctness": 1.0,
            "thinking_clarity": 0.9,
            "reasoning_depth": 0.85
          },
          "validation_notes": "Correctly follows BÆ°á»›c 1. Thinking trace clearly explains why original response was non-compliant and what correction was needed."
        },
        {
          "turn": 2,
          "assistant_message": "Dáº¡, em hÆ°á»›ng dáº«n chá»‹ Ä‘áº·t láº¡i máº­t kháº©u...",
          "scores": {
            "procedure_step_correctness": 1.0,
            "thinking_clarity": 0.95,
            "reasoning_depth": 0.9
          },
          "validation_notes": "Perfect compliance with BÆ°á»›c 3. Thinking explains all 5 sub-steps and rationale for password rules."
        }
      ],
      "compliance_verification": {
        "all_required_steps_present": true,
        "correct_sequence": true,
        "security_guidelines_followed": true,
        "escalation_criteria_clear": true
      },
      "violations_found": [
        {
          "severity": "minor",
          "type": "incomplete_security_note",
          "description": "Thinking could mention BÆ°á»›c 5 vá» xá»­ lÃ½ tÃ¬nh huá»‘ng 'khÃ´ng nháº­n OTP' Ä‘á»ƒ coverage Ä‘áº§y Ä‘á»§ hÆ¡n",
          "recommendation": "Add a note about potential OTP issues and fallback options"
        }
      ],
      "recommendation": "ACCEPT - High quality training data with comprehensive thinking traces. Minor suggestion for improvement but not blocking."
    }
  }

  ---
  OUTPUT cá»§a Agent 3 (User Simulator):

  Dá»±a trÃªn conversation Ä‘Ã£ Ä‘Æ°á»£c ACCEPT, Agent 3 táº¡o ra 3-5 variants vá»›i cÃ¡c edge cases:

  Variant 1: Edge case - KH khÃ´ng nhá»› mÃ£ cá»­a hÃ ng
  {
    "messages": [
      {
        "role": "user",
        "content": "Em quÃªn máº­t kháº©u HVN rá»“i, khÃ´ng biáº¿t lÃ m sao. Em khÃ´ng nhá»› mÃ£ cá»­a hÃ ng ná»¯a, chá»‰ nhá»› tÃªn quÃ¡n lÃ  NhÃ£ Vy, SÄT 0564382859."
      },
      {
        "role": "assistant",
        "content": "Dáº¡, anh/chá»‹ lÃ  chá»§ Ä‘iá»ƒm bÃ¡n, NPP hay nhÃ¢n viÃªn Heineken áº¡? Äá»ƒ em tra cá»©u mÃ£ cá»­a hÃ ng qua tÃªn quÃ¡n vÃ  sá»‘ Ä‘iá»‡n thoáº¡i giÃºp anh/chá»‹ nhÃ©.",
        "thinking": {
          "procedure_step": "BÆ°á»›c 1 & BÆ°á»›c 2: XÃ¡c thá»±c sÆ¡ bá»™ vÃ  xÃ¡c Ä‘á»‹nh tÃªn Ä‘Äƒng nháº­p",
          "reasoning": "KH quÃªn máº­t kháº©u VÃ€ khÃ´ng nhá»› mÃ£ cá»­a hÃ ng. Theo procedure BÆ°á»›c 2:\n- Náº¿u KH khÃ´ng nhá»› mÃ£: tra cá»©u báº±ng tÃªn cá»­a hÃ ng + SÄT + Ä‘á»‹a chá»‰\n- Gá»£i Ã½ phÆ°Æ¡ng Ã¡n Ä‘Äƒng nháº­p báº±ng SÄT náº¿u phÃ¹ há»£p\n\nCáº§n xÃ¡c Ä‘á»‹nh Ä‘á»‘i tÆ°á»£ng (BÆ°á»›c 1) trÆ°á»›c khi tra cá»©u."
        }
      }
    ]
  }

  Variant 2: Edge case - TÃ i khoáº£n bá»‹ khÃ³a
  {
    "messages": [
      {
        "role": "user",
        "content": "App bÃ¡o tÃ i khoáº£n em bá»‹ khÃ³a, khÃ´ng Ä‘Äƒng nháº­p Ä‘Æ°á»£c. MÃ£ outlet 63235514."
      },
      {
        "role": "assistant",
        "content": "Dáº¡, anh/chá»‹ vui lÃ²ng gá»­i em áº£nh mÃ n hÃ¬nh bÃ¡o lá»—i Ä‘á»ƒ em xÃ¡c nháº­n chÃ­nh xÃ¡c tÃ¬nh tráº¡ng. Vá»›i trÆ°á»ng há»£p bá»‹ khÃ³a do nháº­p sai máº­t kháº©u nhiá»u láº§n, anh/chá»‹ cÃ³ thá»ƒ má»Ÿ khÃ³a báº±ng cÃ¡ch thá»±c hiá»‡n 'QuÃªn máº­t kháº©u' Ä‘á»ƒ Ä‘áº·t láº¡i máº­t kháº©u má»›i áº¡.",
        "thinking": {
          "procedure_step": "BÆ°á»›c 1 & BÆ°á»›c 5: Nháº­n diá»‡n + xá»­ lÃ½ tÃ¬nh huá»‘ng bá»‹ khÃ³a",
          "reasoning": "KH bÃ¡o tÃ i khoáº£n bá»‹ khÃ³a - thuá»™c tÃ¬nh huá»‘ng xá»­ lÃ½ á»Ÿ BÆ°á»›c 5 cá»§a procedure:\n- TÃ i khoáº£n bá»‹ khÃ³a: Thá»±c hiá»‡n BÆ°á»›c 3 (QuÃªn máº­t kháº©u) Ä‘á»ƒ má»Ÿ khÃ³a\n\nNÃªn yÃªu cáº§u áº£nh mÃ n hÃ¬nh Ä‘á»ƒ xÃ¡c Ä‘á»‹nh Ä‘Ãºng loáº¡i lá»—i trÆ°á»›c khi hÆ°á»›ng dáº«n."
        }
      }
    ]
  }

  Variant 3: Paraphrase - CÃ¡ch há»i khÃ¡c
  {
    "messages": [
      {
        "role": "user",
        "content": "Anh Æ¡i, sÃ¡ng nÃ£y anh vÃ o app HVN Ä‘Æ°á»£c, giá» nÃ³ bÃ¡o sai máº­t kháº©u mÃ£i. CÃ³ láº½ anh nháº­p sai quÃ¡ nhiá»u láº§n rá»“i."
      },
      // ... tÆ°Æ¡ng tá»± nhÆ°ng vá»›i tone vÃ  context khÃ¡c
    ]
  }

  ---
  ğŸ¯ TÃ³m láº¡i Ã½ nghÄ©a cá»§a tá»«ng Agent:

  | Agent                   | Input                            | Output                                            | Má»¥c Ä‘Ã­ch                                              |
  |-------------------------|----------------------------------|---------------------------------------------------|-------------------------------------------------------|
  | Agent 1: Teacher LLM    | Raw conversation + Procedure     | Enhanced conversation vá»›i thinking traces         | Táº¡o training data cháº¥t lÆ°á»£ng cao, tuÃ¢n thá»§ procedure  |
  | Agent 2: Validator      | Enhanced conversation tá»« Agent 1 | Quality score + Validation report + Accept/Reject | Quality control - chá»‰ cho qua training data Ä‘áº¡t chuáº©n |
  | Agent 3: User Simulator | Accepted conversations           | 3-5 variants vá»›i edge cases                       | Data augmentation - tÄƒng diversity vÃ  coverage        |

  Validation report cá»§a Agent 2 cÃ³ Ã½ nghÄ©a:
  - âœ… Quality gate: Chá»‰ training data Ä‘áº¡t ngÆ°á»¡ng má»›i Ä‘Æ°á»£c dÃ¹ng
  - âœ… Feedback loop: Data bá»‹ reject Ä‘Æ°á»£c gá»­i láº¡i Agent 1 vá»›i chi tiáº¿t lá»—i Ä‘á»ƒ sá»­a
  - âœ… Metrics tracking: Theo dÃµi cháº¥t lÆ°á»£ng tá»•ng thá»ƒ cá»§a synthetic data pipeline

  Báº¡n cÃ³ muá»‘n tÃ´i giáº£i thÃ­ch thÃªm pháº§n nÃ o khÃ´ng?